<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health & Fitness ‚Äì Zeitline</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/styles.css">
    <style>
        /* Health & Fitness specific styles */
        .health-hero {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: linear-gradient(135deg, rgba(255, 59, 48, 0.1), rgba(255, 149, 0, 0.05));
            border: 1px solid rgba(255, 59, 48, 0.2);
            border-radius: 20px;
        }
        
        .watch-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #1a1a20, #2a2a35);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .health-hero-text h2 {
            font-family: 'DM Sans', sans-serif;
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .health-hero-text p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .sync-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(52, 199, 89, 0.15);
            border-radius: 100px;
            font-size: 0.8rem;
            color: #34c759;
            transition: all 0.3s ease;
        }
        
        .sync-status::before {
            content: '';
            width: 8px;
            height: 8px;
            background: #34c759;
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }
        
        .sync-status.syncing {
            background: rgba(0, 122, 255, 0.15);
            color: #007aff;
        }
        
        .sync-status.syncing::before {
            background: #007aff;
        }
        
        .sync-status.waiting {
            background: rgba(255, 149, 0, 0.15);
            color: #ff9500;
        }
        
        .sync-status.waiting::before {
            background: #ff9500;
        }
        
        .refresh-btn {
            margin-left: auto;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: 1px solid var(--border-subtle);
            background: var(--bg-elevated);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .refresh-btn:hover {
            background: rgba(201, 255, 87, 0.1);
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }
        
        .refresh-btn.spinning svg {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }
        
        /* Activity Rings */
        .activity-rings-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        .activity-rings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .activity-rings-header h3 {
            font-family: 'DM Sans', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .activity-rings-content {
            display: flex;
            align-items: center;
            gap: 3rem;
        }
        
        .rings-visual {
            position: relative;
            width: 200px;
            height: 200px;
        }
        
        .rings-svg {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }
        
        .ring-bg {
            fill: none;
            stroke-linecap: round;
        }
        
        .ring-progress {
            fill: none;
            stroke-linecap: round;
            transition: stroke-dashoffset 1s ease-out;
        }
        
        .ring-move-bg { stroke: rgba(255, 59, 48, 0.2); }
        .ring-move-progress { stroke: #ff3b30; filter: drop-shadow(0 0 6px rgba(255, 59, 48, 0.5)); }
        
        .ring-exercise-bg { stroke: rgba(52, 199, 89, 0.2); }
        .ring-exercise-progress { stroke: #34c759; filter: drop-shadow(0 0 6px rgba(52, 199, 89, 0.5)); }
        
        .ring-stand-bg { stroke: rgba(0, 199, 190, 0.2); }
        .ring-stand-progress { stroke: #00c7be; filter: drop-shadow(0 0 6px rgba(0, 199, 190, 0.5)); }
        
        .rings-legend {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .ring-stat {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--bg-elevated);
            border-radius: 12px;
        }
        
        .ring-stat-icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }
        
        .ring-stat-icon.move { background: rgba(255, 59, 48, 0.15); }
        .ring-stat-icon.exercise { background: rgba(52, 199, 89, 0.15); }
        .ring-stat-icon.stand { background: rgba(0, 199, 190, 0.15); }
        
        .ring-stat-info {
            flex: 1;
        }
        
        .ring-stat-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .ring-stat-value {
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .ring-stat-value.move { color: #ff3b30; }
        .ring-stat-value.exercise { color: #34c759; }
        .ring-stat-value.stand { color: #00c7be; }
        
        .ring-stat-goal {
            font-size: 0.85rem;
            color: var(--text-muted);
        }
        
        /* Health Metrics Grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .metric-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 20px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-2px);
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        .metric-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        
        .metric-icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }
        
        .metric-icon.heart { background: rgba(255, 59, 48, 0.15); }
        .metric-icon.steps { background: rgba(255, 149, 0, 0.15); }
        .metric-icon.calories { background: rgba(255, 204, 0, 0.15); }
        .metric-icon.distance { background: rgba(52, 199, 89, 0.15); }
        .metric-icon.sleep { background: rgba(175, 82, 222, 0.15); }
        .metric-icon.oxygen { background: rgba(0, 122, 255, 0.15); }
        
        .metric-title {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .metric-value {
            font-family: 'Instrument Serif', Georgia, serif;
            font-size: 2.5rem;
            margin-bottom: 0.25rem;
        }
        
        .metric-value .unit {
            font-family: 'DM Sans', sans-serif;
            font-size: 1rem;
            color: var(--text-muted);
        }
        
        .metric-subtitle {
            font-size: 0.85rem;
            color: var(--text-muted);
        }
        
        .metric-chart {
            margin-top: 1rem;
            height: 60px;
            display: flex;
            align-items: flex-end;
            gap: 4px;
        }
        
        .chart-bar {
            flex: 1;
            background: rgba(255, 59, 48, 0.3);
            border-radius: 4px 4px 0 0;
            transition: height 0.5s ease;
        }
        
        .chart-bar.active {
            background: linear-gradient(180deg, #ff3b30, #ff6961);
        }
        
        /* Heart Rate Detail */
        .heart-stats {
            display: flex;
            gap: 1.5rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-subtle);
        }
        
        .heart-stat {
            text-align: center;
        }
        
        .heart-stat-value {
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        .heart-stat-value.low { color: #34c759; }
        .heart-stat-value.avg { color: #ff9500; }
        .heart-stat-value.high { color: #ff3b30; }
        
        .heart-stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        /* Workouts Section */
        .workouts-section {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 20px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .section-header h3 {
            font-family: 'DM Sans', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .workout-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .workout-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--bg-elevated);
            border-radius: 14px;
            transition: all 0.3s ease;
        }
        
        .workout-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .workout-icon {
            width: 50px;
            height: 50px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .workout-icon.run { background: linear-gradient(135deg, rgba(52, 199, 89, 0.2), rgba(52, 199, 89, 0.1)); }
        .workout-icon.cycle { background: linear-gradient(135deg, rgba(255, 149, 0, 0.2), rgba(255, 149, 0, 0.1)); }
        .workout-icon.swim { background: linear-gradient(135deg, rgba(0, 122, 255, 0.2), rgba(0, 122, 255, 0.1)); }
        .workout-icon.strength { background: linear-gradient(135deg, rgba(255, 59, 48, 0.2), rgba(255, 59, 48, 0.1)); }
        .workout-icon.yoga { background: linear-gradient(135deg, rgba(175, 82, 222, 0.2), rgba(175, 82, 222, 0.1)); }
        
        .workout-details {
            flex: 1;
        }
        
        .workout-name {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }
        
        .workout-meta {
            font-size: 0.85rem;
            color: var(--text-muted);
        }
        
        .workout-stats {
            display: flex;
            gap: 1.5rem;
            text-align: right;
        }
        
        .workout-stat-value {
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .workout-stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
        }
        
        /* Sleep Section */
        .sleep-card {
            background: linear-gradient(135deg, rgba(175, 82, 222, 0.1), rgba(88, 86, 214, 0.05));
            border: 1px solid rgba(175, 82, 222, 0.2);
        }
        
        .sleep-visual {
            margin-top: 1rem;
            height: 80px;
            background: var(--bg-elevated);
            border-radius: 12px;
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 2px;
        }
        
        .sleep-block {
            height: 100%;
            border-radius: 4px;
            transition: all 0.3s ease;
        }
        
        .sleep-block.awake { background: rgba(255, 204, 0, 0.6); flex: 1; }
        .sleep-block.rem { background: rgba(0, 122, 255, 0.6); flex: 2; }
        .sleep-block.core { background: rgba(88, 86, 214, 0.6); flex: 4; }
        .sleep-block.deep { background: rgba(175, 82, 222, 0.8); flex: 2; }
        
        .sleep-legend {
            display: flex;
            gap: 1.5rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        
        .sleep-legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        
        .sleep-legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 4px;
        }
        
        .sleep-legend-dot.awake { background: rgba(255, 204, 0, 0.6); }
        .sleep-legend-dot.rem { background: rgba(0, 122, 255, 0.6); }
        .sleep-legend-dot.core { background: rgba(88, 86, 214, 0.6); }
        .sleep-legend-dot.deep { background: rgba(175, 82, 222, 0.8); }
        
        /* Trends Section */
        .trends-section {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 20px;
            padding: 1.5rem;
        }
        
        .trend-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }
        
        .trend-tab {
            padding: 0.5rem 1rem;
            background: transparent;
            border: 1px solid var(--border-subtle);
            border-radius: 100px;
            color: var(--text-secondary);
            font-size: 0.85rem;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .trend-tab:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .trend-tab.active {
            background: rgba(201, 255, 87, 0.1);
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }
        
        .trend-chart {
            height: 200px;
            display: flex;
            align-items: flex-end;
            gap: 8px;
            padding: 1rem 0;
        }
        
        .trend-bar {
            flex: 1;
            background: linear-gradient(180deg, var(--accent-primary), rgba(201, 255, 87, 0.3));
            border-radius: 6px 6px 0 0;
            position: relative;
            transition: all 0.5s ease;
        }
        
        .trend-bar::after {
            content: attr(data-label);
            position: absolute;
            bottom: -24px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.7rem;
            color: var(--text-muted);
        }
        
        /* Calorie Tracker Styles */
        .calorie-tracker {
            background: linear-gradient(135deg, rgba(201, 255, 87, 0.08) 0%, rgba(87, 255, 212, 0.05) 100%);
            border: 1px solid rgba(201, 255, 87, 0.2);
            border-radius: 20px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .calorie-tracker-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .calorie-tracker-header h3 {
            font-family: 'DM Sans', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .calorie-goal-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-subtle);
            color: var(--text-secondary);
            padding: 0.4rem 0.8rem;
            border-radius: 100px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }
        
        .calorie-goal-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }
        
        .calorie-budget-display {
            display: grid;
            grid-template-columns: 1fr 160px 1fr;
            align-items: center;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .calorie-stat {
            text-align: center;
        }
        
        .calorie-stat-value {
            font-family: 'Instrument Serif', Georgia, serif;
            font-size: 2rem;
            font-weight: 400;
            line-height: 1;
        }
        
        .calorie-stat-value.eaten {
            color: var(--accent-tertiary);
        }
        
        .calorie-stat-value.remaining {
            color: var(--accent-secondary);
        }
        
        .calorie-stat-value.over-budget {
            color: #ff4444;
        }
        
        .calorie-stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 0.35rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .calorie-ring-wrap {
            position: relative;
            width: 160px;
            height: 160px;
        }
        
        .calorie-ring-wrap svg {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }
        
        .calorie-ring-bg {
            fill: none;
            stroke: rgba(255, 255, 255, 0.1);
            stroke-width: 14;
        }
        
        .calorie-ring-progress {
            fill: none;
            stroke: url(#calorieGradient);
            stroke-width: 14;
            stroke-linecap: round;
            stroke-dasharray: 408.4;
            stroke-dashoffset: 408.4;
            transition: stroke-dashoffset 0.8s ease;
        }
        
        .calorie-ring-progress.over-budget {
            stroke: #ff4444;
        }
        
        .calorie-ring-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
        
        .calorie-ring-value {
            font-family: 'Instrument Serif', Georgia, serif;
            font-size: 1.75rem;
            font-weight: 400;
            line-height: 1;
        }
        
        .calorie-ring-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-top: 0.2rem;
        }
        
        .add-food-row {
            display: flex;
            gap: 0.6rem;
            margin-bottom: 1rem;
        }
        
        .food-input {
            flex: 1;
            padding: 0.75rem 1rem;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 0.9rem;
            font-family: inherit;
            transition: all 0.3s ease;
        }
        
        .food-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(201, 255, 87, 0.15);
        }
        
        .food-input::placeholder {
            color: var(--text-muted);
        }
        
        .calories-input {
            width: 100px;
        }
        
        .add-food-btn {
            background: var(--accent-primary);
            border: none;
            color: var(--bg-deep);
            padding: 0.75rem 1.25rem;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }
        
        .add-food-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(201, 255, 87, 0.25);
        }
        
        .add-food-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .food-log {
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .food-log-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.65rem 0.85rem;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            transition: all 0.2s ease;
        }
        
        .food-log-item:hover {
            background: rgba(0, 0, 0, 0.3);
        }
        
        .food-log-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background: rgba(201, 255, 87, 0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }
        
        .food-log-info {
            flex: 1;
        }
        
        .food-log-name {
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .food-log-time {
            font-size: 0.7rem;
            color: var(--text-muted);
        }
        
        .food-log-calories {
            font-weight: 600;
            color: var(--accent-tertiary);
            font-size: 0.9rem;
        }
        
        .food-log-delete {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 0.35rem;
            opacity: 0;
            transition: all 0.2s ease;
            font-size: 0.9rem;
        }
        
        .food-log-item:hover .food-log-delete {
            opacity: 1;
        }
        
        .food-log-delete:hover {
            color: var(--accent-tertiary);
        }
        
        .food-log-empty {
            text-align: center;
            padding: 1.5rem;
            color: var(--text-muted);
            font-size: 0.9rem;
        }
        
        /* Food Search Styles */
        .food-search-container {
            position: relative;
            margin-bottom: 1rem;
        }
        
        .food-search-input {
            width: 100%;
            padding: 0.85rem 1rem 0.85rem 2.75rem;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-subtle);
            border-radius: 14px;
            color: var(--text-primary);
            font-size: 0.95rem;
            font-family: inherit;
            transition: all 0.3s ease;
        }
        
        .food-search-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(201, 255, 87, 0.15);
        }
        
        .food-search-input::placeholder {
            color: var(--text-muted);
        }
        
        .food-search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            pointer-events: none;
        }
        
        .food-search-clear {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 0.25rem;
            font-size: 1.1rem;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .food-search-container.has-value .food-search-clear {
            opacity: 1;
        }
        
        .food-search-clear:hover {
            color: var(--text-primary);
        }
        
        .search-results-dropdown {
            position: absolute;
            top: calc(100% + 0.5rem);
            left: 0;
            right: 0;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 14px;
            max-height: 320px;
            overflow-y: auto;
            z-index: 100;
            display: none;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
        }
        
        .search-results-dropdown.active {
            display: block;
            animation: dropdownFade 0.2s ease;
        }
        
        @keyframes dropdownFade {
            from { opacity: 0; transform: translateY(-8px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .search-result-item {
            display: flex;
            align-items: center;
            gap: 0.85rem;
            padding: 0.85rem 1rem;
            cursor: pointer;
            transition: background 0.2s;
            border-bottom: 1px solid var(--border-subtle);
        }
        
        .search-result-item:last-child {
            border-bottom: none;
        }
        
        .search-result-item:hover {
            background: rgba(201, 255, 87, 0.08);
        }
        
        .search-result-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: var(--bg-elevated);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            flex-shrink: 0;
        }
        
        .search-result-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 10px;
        }
        
        .search-result-info {
            flex: 1;
            min-width: 0;
        }
        
        .search-result-name {
            font-weight: 500;
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .search-result-brand {
            font-size: 0.75rem;
            color: var(--text-muted);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .search-result-cals {
            font-weight: 600;
            color: var(--accent-secondary);
            font-size: 0.85rem;
            white-space: nowrap;
        }
        
        .search-result-add {
            background: var(--accent-primary);
            border: none;
            color: var(--bg-deep);
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            flex-shrink: 0;
        }
        
        .search-result-add:hover {
            transform: scale(1.1);
        }
        
        .search-loading, .search-empty {
            padding: 1.5rem;
            text-align: center;
            color: var(--text-muted);
            font-size: 0.9rem;
        }
        
        .search-loading::before {
            content: '';
            display: inline-block;
            width: 18px;
            height: 18px;
            border: 2px solid var(--border-subtle);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-right: 0.5rem;
            vertical-align: middle;
        }
        
        .manual-entry-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.6rem;
            color: var(--text-secondary);
            font-size: 0.8rem;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .manual-entry-toggle:hover {
            color: var(--accent-primary);
        }
        
        .manual-entry-row {
            display: none;
            gap: 0.6rem;
            margin-bottom: 0.75rem;
        }
        
        .manual-entry-row.active {
            display: flex;
        }
        
        /* Goal Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 20px;
            width: 90%;
            max-width: 400px;
            padding: 1.75rem;
            transform: scale(0.9) translateY(20px);
            transition: transform 0.3s ease;
        }
        
        .modal-overlay.active .modal {
            transform: scale(1) translateY(0);
        }
        
        .modal h3 {
            font-family: 'Instrument Serif', Georgia, serif;
            font-size: 1.35rem;
            margin-bottom: 0.4rem;
        }
        
        .modal > p {
            color: var(--text-secondary);
            margin-bottom: 1.25rem;
            font-size: 0.85rem;
        }
        
        .quick-goals {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .quick-goal-btn {
            flex: 1;
            padding: 0.6rem;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            color: var(--text-secondary);
            font-size: 0.8rem;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .quick-goal-btn:hover {
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }
        
        .modal-input-group {
            margin-bottom: 1.25rem;
        }
        
        .modal-input-group label {
            display: block;
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 0.4rem;
        }
        
        .modal-input {
            width: 100%;
            padding: 0.85rem 1rem;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 1.15rem;
            font-family: inherit;
            text-align: center;
        }
        
        .modal-input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }
        
        .modal-actions {
            display: flex;
            gap: 0.75rem;
        }
        
        .modal-actions button {
            flex: 1;
            padding: 0.75rem;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .modal-cancel {
            background: transparent;
            border: 1px solid var(--border-subtle);
            color: var(--text-secondary);
        }
        
        .modal-cancel:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .modal-save {
            background: var(--accent-primary);
            border: none;
            color: var(--bg-deep);
        }
        
        .modal-save:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(201, 255, 87, 0.25);
        }
        
        @media (max-width: 768px) {
            .activity-rings-content {
                flex-direction: column;
            }
            
            .workout-stats {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .health-hero {
                flex-direction: column;
                text-align: center;
            }
            
            .sync-status {
                margin-left: 0;
            }
            
            .calorie-budget-display {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .calorie-ring-wrap {
                margin: 0 auto;
                order: -1;
            }
            
            .add-food-row {
                flex-direction: column;
            }
            
            .calories-input {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <!-- Sidebar -->
        <aside class="sidebar">
            <a href="/" class="logo">ZEITLINE</a>
            
            <nav class="sidebar-nav">
                <a href="/dashboard.html" class="nav-item">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7"/>
                        <rect x="14" y="3" width="7" height="7"/>
                        <rect x="14" y="14" width="7" height="7"/>
                        <rect x="3" y="14" width="7" height="7"/>
                    </svg>
                    Dashboard
                </a>
                <a href="/timeline.html" class="nav-item">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="2" x2="12" y2="22"/>
                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                    </svg>
                    Timeline
                </a>
                <a href="/calendar.html" class="nav-item">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                        <line x1="16" y1="2" x2="16" y2="6"/>
                        <line x1="8" y1="2" x2="8" y2="6"/>
                        <line x1="3" y1="10" x2="21" y2="10"/>
                    </svg>
                    Calendar
                </a>
                <a href="/recordings.html" class="nav-item">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
                        <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                        <line x1="12" y1="19" x2="12" y2="23"/>
                        <line x1="8" y1="23" x2="16" y2="23"/>
                    </svg>
                    Recordings
                </a>
                <a href="/events.html" class="nav-item">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 11l3 3L22 4"/>
                        <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
                    </svg>
                    Events & Tasks
                </a>
                <a href="/health-fitness.html" class="nav-item active">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                    </svg>
                    Health
                </a>
                <a href="#" class="nav-item">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="20" x2="18" y2="10"/>
                        <line x1="12" y1="20" x2="12" y2="4"/>
                        <line x1="6" y1="20" x2="6" y2="14"/>
                    </svg>
                    Insights
                </a>
                <a href="/about-me.html" class="nav-item">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                        <circle cx="12" cy="7" r="4"/>
                    </svg>
                    About Me
                </a>
                <a href="/settings.html" class="nav-item">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                    </svg>
                    Settings
                </a>
            </nav>
            
            <div class="sidebar-footer">
                <button class="btn btn-ghost" style="width: 100%; justify-content: flex-start;" onclick="signOut()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                        <polyline points="16 17 21 12 16 7"/>
                        <line x1="21" y1="12" x2="9" y2="12"/>
                    </svg>
                    Log out
                </button>
            </div>
        </aside>
        
        <!-- Main Content -->
        <main class="main-content">
            <div class="dashboard-header">
                <h1>Health & Fitness</h1>
                <div class="user-menu">
                    <div class="user-avatar" id="userAvatar">U</div>
                </div>
            </div>
            
            <!-- Apple Watch Connection Status -->
            <div class="health-hero">
                <div class="watch-icon">‚åö</div>
                <div class="health-hero-text">
                    <h2>Apple Watch Connected</h2>
                    <p>Syncing health data from your Apple Watch</p>
                </div>
                <div class="sync-status" id="syncStatus">
                    Connecting...
                </div>
                <button class="refresh-btn" id="refreshBtn" onclick="refreshHealthData()" title="Refresh health data">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M23 4v6h-6"/>
                        <path d="M1 20v-6h6"/>
                        <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                    </svg>
                </button>
            </div>
            
            <!-- Activity Rings -->
            <div class="activity-rings-card">
                <div class="activity-rings-header">
                    <h3>Today's Activity</h3>
                    <span style="color: var(--text-muted); font-size: 0.85rem;">December 30, 2024</span>
                </div>
                <div class="activity-rings-content">
                    <div class="rings-visual">
                        <svg class="rings-svg" viewBox="0 0 200 200">
                            <!-- Move Ring (outer) - radius 90, circumference = 2 * PI * 90 = 565.48 -->
                            <circle class="ring-bg ring-move-bg" cx="100" cy="100" r="90" stroke-width="14"/>
                            <circle class="ring-progress ring-move-progress" id="ring-move" cx="100" cy="100" r="90" stroke-width="14"
                                stroke-dasharray="565.48" stroke-dashoffset="113"/>
                            
                            <!-- Exercise Ring (middle) - radius 70, circumference = 2 * PI * 70 = 439.82 -->
                            <circle class="ring-bg ring-exercise-bg" cx="100" cy="100" r="70" stroke-width="14"/>
                            <circle class="ring-progress ring-exercise-progress" id="ring-exercise" cx="100" cy="100" r="70" stroke-width="14"
                                stroke-dasharray="439.82" stroke-dashoffset="132"/>
                            
                            <!-- Stand Ring (inner) - radius 50, circumference = 2 * PI * 50 = 314.16 -->
                            <circle class="ring-bg ring-stand-bg" cx="100" cy="100" r="50" stroke-width="14"/>
                            <circle class="ring-progress ring-stand-progress" id="ring-stand" cx="100" cy="100" r="50" stroke-width="14"
                                stroke-dasharray="314.16" stroke-dashoffset="78"/>
                        </svg>
                    </div>
                    <div class="rings-legend">
                        <div class="ring-stat">
                            <div class="ring-stat-icon move">üî•</div>
                            <div class="ring-stat-info">
                                <div class="ring-stat-label">Move</div>
                                <div class="ring-stat-value move">487 <span style="font-size: 0.9rem; color: var(--text-muted);">/ 600 CAL</span></div>
                            </div>
                            <div class="ring-stat-goal">81%</div>
                        </div>
                        <div class="ring-stat">
                            <div class="ring-stat-icon exercise">üí™</div>
                            <div class="ring-stat-info">
                                <div class="ring-stat-label">Exercise</div>
                                <div class="ring-stat-value exercise">22 <span style="font-size: 0.9rem; color: var(--text-muted);">/ 30 MIN</span></div>
                            </div>
                            <div class="ring-stat-goal">73%</div>
                        </div>
                        <div class="ring-stat">
                            <div class="ring-stat-icon stand">üßç</div>
                            <div class="ring-stat-info">
                                <div class="ring-stat-label">Stand</div>
                                <div class="ring-stat-value stand">9 <span style="font-size: 0.9rem; color: var(--text-muted);">/ 12 HRS</span></div>
                            </div>
                            <div class="ring-stat-goal">75%</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Calorie Budget Tracker -->
            <div class="calorie-tracker" id="calorieTracker">
                <div class="calorie-tracker-header">
                    <h3>üçΩÔ∏è Calorie Budget</h3>
                    <button class="calorie-goal-btn" onclick="openGoalModal()">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                        </svg>
                        Set Goal
                    </button>
                </div>
                
                <div class="calorie-budget-display">
                    <div class="calorie-stat">
                        <div class="calorie-stat-value eaten" id="caloriesEatenDisplay">0</div>
                        <div class="calorie-stat-label">Eaten</div>
                    </div>
                    
                    <div class="calorie-ring-wrap">
                        <svg viewBox="0 0 150 150">
                            <defs>
                                <linearGradient id="calorieGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" stop-color="var(--accent-primary)"/>
                                    <stop offset="100%" stop-color="var(--accent-secondary)"/>
                                </linearGradient>
                            </defs>
                            <circle class="calorie-ring-bg" cx="75" cy="75" r="65"/>
                            <circle class="calorie-ring-progress" id="calorieRingProgress" cx="75" cy="75" r="65"/>
                        </svg>
                        <div class="calorie-ring-center">
                            <div class="calorie-ring-value" id="calorieGoalDisplay">2000</div>
                            <div class="calorie-ring-label">cal goal</div>
                        </div>
                    </div>
                    
                    <div class="calorie-stat">
                        <div class="calorie-stat-value remaining" id="caloriesRemainingDisplay">2000</div>
                        <div class="calorie-stat-label">Remaining</div>
                    </div>
                </div>
                
                <!-- Food Search -->
                <div class="food-search-container" id="foodSearchContainer">
                    <svg class="food-search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="M21 21l-4.35-4.35"/>
                    </svg>
                    <input type="text" class="food-search-input" id="foodSearchInput" placeholder="Search foods (e.g., banana, chicken breast...)" autocomplete="off">
                    <button class="food-search-clear" id="searchClear" onclick="clearSearch()">√ó</button>
                    
                    <div class="search-results-dropdown" id="searchResults">
                        <!-- Results populated by JS -->
                    </div>
                </div>
                
                <!-- Manual Entry Toggle -->
                <div class="manual-entry-toggle" onclick="toggleManualEntry()">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 5v14M5 12h14"/>
                    </svg>
                    <span id="manualToggleText">Add manually</span>
                </div>
                
                <!-- Manual Entry Row (hidden by default) -->
                <div class="manual-entry-row" id="manualEntryRow">
                    <input type="text" class="food-input" id="foodNameInput" placeholder="Food name" autocomplete="off">
                    <input type="number" class="food-input calories-input" id="foodCaloriesInput" placeholder="Calories" min="0">
                    <button class="add-food-btn" id="addFoodBtn" onclick="addFoodEntry()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <path d="M12 5v14M5 12h14"/>
                        </svg>
                        Add
                    </button>
                </div>
                
                <div class="food-log" id="foodLog">
                    <div class="food-log-empty">
                        ü•ó No food logged today
                    </div>
                </div>
            </div>
            
            <!-- Goal Setting Modal -->
            <div class="modal-overlay" id="goalModal">
                <div class="modal">
                    <h3>üéØ Set Daily Calorie Goal</h3>
                    <p>How many calories do you want to limit yourself to each day?</p>
                    
                    <div class="quick-goals">
                        <button class="quick-goal-btn" onclick="setQuickGoal(1500)">1500</button>
                        <button class="quick-goal-btn" onclick="setQuickGoal(1800)">1800</button>
                        <button class="quick-goal-btn" onclick="setQuickGoal(2000)">2000</button>
                        <button class="quick-goal-btn" onclick="setQuickGoal(2500)">2500</button>
                    </div>
                    
                    <div class="modal-input-group">
                        <label for="goalInput">Custom calorie goal</label>
                        <input type="number" class="modal-input" id="goalInput" placeholder="2000" min="500" max="10000">
                    </div>
                    
                    <div class="modal-actions">
                        <button class="modal-cancel" onclick="closeGoalModal()">Cancel</button>
                        <button class="modal-save" onclick="saveCalorieGoal()">Save Goal</button>
                    </div>
                </div>
            </div>
            
            <!-- Health Metrics Grid -->
            <div class="metrics-grid">
                <!-- Heart Rate -->
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-icon heart">‚ù§Ô∏è</div>
                        <span class="metric-title">Heart Rate</span>
                    </div>
                    <div class="metric-value">72 <span class="unit">BPM</span></div>
                    <div class="metric-subtitle">Current ‚Ä¢ Resting</div>
                    <div class="metric-chart">
                        <div class="chart-bar" style="height: 40%;"></div>
                        <div class="chart-bar" style="height: 45%;"></div>
                        <div class="chart-bar" style="height: 55%;"></div>
                        <div class="chart-bar" style="height: 50%;"></div>
                        <div class="chart-bar" style="height: 65%;"></div>
                        <div class="chart-bar" style="height: 85%;"></div>
                        <div class="chart-bar" style="height: 70%;"></div>
                        <div class="chart-bar" style="height: 60%;"></div>
                        <div class="chart-bar" style="height: 55%;"></div>
                        <div class="chart-bar" style="height: 50%;"></div>
                        <div class="chart-bar active" style="height: 48%;"></div>
                    </div>
                    <div class="heart-stats">
                        <div class="heart-stat">
                            <div class="heart-stat-value low">52</div>
                            <div class="heart-stat-label">Low</div>
                        </div>
                        <div class="heart-stat">
                            <div class="heart-stat-value avg">68</div>
                            <div class="heart-stat-label">Avg</div>
                        </div>
                        <div class="heart-stat">
                            <div class="heart-stat-value high">142</div>
                            <div class="heart-stat-label">High</div>
                        </div>
                    </div>
                </div>
                
                <!-- Steps -->
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-icon steps">üëü</div>
                        <span class="metric-title">Steps</span>
                    </div>
                    <div class="metric-value">8,432</div>
                    <div class="metric-subtitle">Goal: 10,000 steps</div>
                    <div style="margin-top: 1rem; height: 8px; background: var(--bg-elevated); border-radius: 4px; overflow: hidden;">
                        <div style="height: 100%; width: 84%; background: linear-gradient(90deg, #ff9500, #ffcc00); border-radius: 4px;"></div>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-top: 0.5rem; font-size: 0.8rem; color: var(--text-muted);">
                        <span>84% of daily goal</span>
                        <span>1,568 to go</span>
                    </div>
                </div>
                
                <!-- Calories -->
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-icon calories">üî•</div>
                        <span class="metric-title">Active Calories</span>
                    </div>
                    <div class="metric-value">487 <span class="unit">CAL</span></div>
                    <div class="metric-subtitle">Total: 1,842 cal (incl. resting)</div>
                    <div style="margin-top: 1.5rem; display: flex; gap: 1rem;">
                        <div style="flex: 1; text-align: center; padding: 0.75rem; background: var(--bg-elevated); border-radius: 10px;">
                            <div style="font-size: 1.25rem; font-weight: 600; color: #ffcc00;">1,355</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">Resting</div>
                        </div>
                        <div style="flex: 1; text-align: center; padding: 0.75rem; background: var(--bg-elevated); border-radius: 10px;">
                            <div style="font-size: 1.25rem; font-weight: 600; color: #ff9500;">487</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">Active</div>
                        </div>
                    </div>
                </div>
                
                <!-- Distance -->
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-icon distance">üìç</div>
                        <span class="metric-title">Distance</span>
                    </div>
                    <div class="metric-value">4.2 <span class="unit">MI</span></div>
                    <div class="metric-subtitle">Walking + Running</div>
                    <div style="margin-top: 1.5rem; display: flex; gap: 1rem;">
                        <div style="flex: 1; text-align: center; padding: 0.75rem; background: var(--bg-elevated); border-radius: 10px;">
                            <div style="font-size: 1.25rem; font-weight: 600; color: #34c759;">12</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">Floors</div>
                        </div>
                        <div style="flex: 1; text-align: center; padding: 0.75rem; background: var(--bg-elevated); border-radius: 10px;">
                            <div style="font-size: 1.25rem; font-weight: 600; color: #34c759;">2.1k</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">Elevation</div>
                        </div>
                    </div>
                </div>
                
                <!-- Blood Oxygen -->
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-icon oxygen">üí®</div>
                        <span class="metric-title">Blood Oxygen</span>
                    </div>
                    <div class="metric-value">98<span class="unit">%</span></div>
                    <div class="metric-subtitle">Last measured at 2:30 PM</div>
                    <div style="margin-top: 1rem; padding: 1rem; background: rgba(0, 122, 255, 0.1); border-radius: 12px; display: flex; align-items: center; gap: 0.75rem;">
                        <span style="font-size: 1.25rem;">‚úì</span>
                        <span style="font-size: 0.85rem; color: #007aff;">Normal range (95-100%)</span>
                    </div>
                </div>
                
                <!-- Sleep -->
                <div class="metric-card sleep-card">
                    <div class="metric-header">
                        <div class="metric-icon sleep">üò¥</div>
                        <span class="metric-title">Sleep</span>
                    </div>
                    <div class="metric-value">7h 24m</div>
                    <div class="metric-subtitle">Last night ‚Ä¢ 11:15 PM ‚Äì 6:39 AM</div>
                    <div class="sleep-visual">
                        <div class="sleep-block awake"></div>
                        <div class="sleep-block core"></div>
                        <div class="sleep-block rem"></div>
                        <div class="sleep-block deep"></div>
                        <div class="sleep-block core"></div>
                        <div class="sleep-block rem"></div>
                        <div class="sleep-block core"></div>
                        <div class="sleep-block awake"></div>
                    </div>
                    <div class="sleep-legend">
                        <div class="sleep-legend-item">
                            <div class="sleep-legend-dot awake"></div>
                            <span>Awake (18m)</span>
                        </div>
                        <div class="sleep-legend-item">
                            <div class="sleep-legend-dot rem"></div>
                            <span>REM (1h 42m)</span>
                        </div>
                        <div class="sleep-legend-item">
                            <div class="sleep-legend-dot core"></div>
                            <span>Core (4h 12m)</span>
                        </div>
                        <div class="sleep-legend-item">
                            <div class="sleep-legend-dot deep"></div>
                            <span>Deep (1h 12m)</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Recent Workouts -->
            <div class="workouts-section">
                <div class="section-header">
                    <h3>Recent Workouts</h3>
                    <button class="btn btn-ghost">View All ‚Üí</button>
                </div>
                <div class="workout-list">
                    <div class="workout-item">
                        <div class="workout-icon run">üèÉ</div>
                        <div class="workout-details">
                            <div class="workout-name">Outdoor Run</div>
                            <div class="workout-meta">Today at 7:15 AM ‚Ä¢ Golden Gate Park</div>
                        </div>
                        <div class="workout-stats">
                            <div>
                                <div class="workout-stat-value">3.2 mi</div>
                                <div class="workout-stat-label">Distance</div>
                            </div>
                            <div>
                                <div class="workout-stat-value">28:45</div>
                                <div class="workout-stat-label">Time</div>
                            </div>
                            <div>
                                <div class="workout-stat-value">312</div>
                                <div class="workout-stat-label">Cal</div>
                            </div>
                        </div>
                    </div>
                    <div class="workout-item">
                        <div class="workout-icon strength">üèãÔ∏è</div>
                        <div class="workout-details">
                            <div class="workout-name">Strength Training</div>
                            <div class="workout-meta">Yesterday at 6:00 PM ‚Ä¢ Home Gym</div>
                        </div>
                        <div class="workout-stats">
                            <div>
                                <div class="workout-stat-value">‚Äî</div>
                                <div class="workout-stat-label">Distance</div>
                            </div>
                            <div>
                                <div class="workout-stat-value">45:00</div>
                                <div class="workout-stat-label">Time</div>
                            </div>
                            <div>
                                <div class="workout-stat-value">285</div>
                                <div class="workout-stat-label">Cal</div>
                            </div>
                        </div>
                    </div>
                    <div class="workout-item">
                        <div class="workout-icon yoga">üßò</div>
                        <div class="workout-details">
                            <div class="workout-name">Yoga</div>
                            <div class="workout-meta">Dec 28 at 8:00 AM ‚Ä¢ Living Room</div>
                        </div>
                        <div class="workout-stats">
                            <div>
                                <div class="workout-stat-value">‚Äî</div>
                                <div class="workout-stat-label">Distance</div>
                            </div>
                            <div>
                                <div class="workout-stat-value">30:00</div>
                                <div class="workout-stat-label">Time</div>
                            </div>
                            <div>
                                <div class="workout-stat-value">95</div>
                                <div class="workout-stat-label">Cal</div>
                            </div>
                        </div>
                    </div>
                    <div class="workout-item">
                        <div class="workout-icon cycle">üö¥</div>
                        <div class="workout-details">
                            <div class="workout-name">Outdoor Cycle</div>
                            <div class="workout-meta">Dec 27 at 4:30 PM ‚Ä¢ Marina District</div>
                        </div>
                        <div class="workout-stats">
                            <div>
                                <div class="workout-stat-value">12.5 mi</div>
                                <div class="workout-stat-label">Distance</div>
                            </div>
                            <div>
                                <div class="workout-stat-value">52:30</div>
                                <div class="workout-stat-label">Time</div>
                            </div>
                            <div>
                                <div class="workout-stat-value">428</div>
                                <div class="workout-stat-label">Cal</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Weekly Trends -->
            <div class="trends-section">
                <div class="section-header">
                    <h3>Weekly Trends</h3>
                </div>
                <div class="trend-tabs">
                    <button class="trend-tab active">Steps</button>
                    <button class="trend-tab">Calories</button>
                    <button class="trend-tab">Exercise</button>
                    <button class="trend-tab">Sleep</button>
                </div>
                <div class="trend-chart">
                    <div class="trend-bar" style="height: 65%;" data-label="Mon"></div>
                    <div class="trend-bar" style="height: 78%;" data-label="Tue"></div>
                    <div class="trend-bar" style="height: 92%;" data-label="Wed"></div>
                    <div class="trend-bar" style="height: 45%;" data-label="Thu"></div>
                    <div class="trend-bar" style="height: 88%;" data-label="Fri"></div>
                    <div class="trend-bar" style="height: 100%;" data-label="Sat"></div>
                    <div class="trend-bar" style="height: 84%;" data-label="Sun"></div>
                </div>
                <div style="display: flex; justify-content: space-between; margin-top: 2rem; padding-top: 1rem; border-top: 1px solid var(--border-subtle);">
                    <div>
                        <div style="font-size: 0.8rem; color: var(--text-muted);">Weekly Average</div>
                        <div style="font-size: 1.5rem; font-weight: 600;">9,245 steps</div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 0.8rem; color: var(--text-muted);">vs Last Week</div>
                        <div style="font-size: 1.5rem; font-weight: 600; color: #34c759;">‚Üë 12%</div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="/js/firebase-config.js"></script>
    <script src="/js/health.js"></script>
    <script>
        // Load user info
        document.addEventListener('DOMContentLoaded', () => {
            const savedProfile = localStorage.getItem('zeitline_profile');
            if (savedProfile) {
                try {
                    const profile = JSON.parse(savedProfile);
                    const firstName = profile?.personal?.fullName?.split(' ')[0] || 'U';
                    document.getElementById('userAvatar').textContent = firstName.charAt(0).toUpperCase();
                } catch (e) {
                    console.log('Could not load saved profile');
                }
            }
        });
        
        // Redirect to login if not authenticated
        window.addEventListener('authStateChanged', (e) => {
            if (!e.detail) {
                window.location.href = '/login.html';
            }
        });
        
        // Refresh health data function - triggers iOS app to sync
        async function refreshHealthData() {
            const btn = document.getElementById('refreshBtn');
            const status = document.getElementById('syncStatus');
            
            // Add spinning animation
            btn.classList.add('spinning');
            status.textContent = 'Requesting sync...';
            status.className = 'sync-status syncing';
            
            try {
                const user = firebase.auth().currentUser;
                if (!user) {
                    throw new Error('Not logged in');
                }
                
                // Write a sync request to Firebase - the iOS app will pick this up
                await db.collection('users').doc(user.uid).set({
                    syncRequest: {
                        requestedAt: firebase.firestore.FieldValue.serverTimestamp(),
                        source: 'web'
                    }
                }, { merge: true });
                
                console.log('üì§ Sync request sent to iOS app');
                status.textContent = 'Sync requested...';
                
                // Wait a few seconds for the iOS app to respond
                await new Promise(resolve => setTimeout(resolve, 3000));
                
                // Refresh weekly data
                if (typeof healthDashboard !== 'undefined' && healthDashboard) {
                    healthDashboard.fetchWeeklyData();
                }
                
                btn.classList.remove('spinning');
                if (healthDashboard && healthDashboard.healthData) {
                    status.textContent = 'Updated just now';
                    status.className = 'sync-status';
                } else {
                    status.textContent = 'Open app to sync';
                    status.className = 'sync-status waiting';
                }
            } catch (error) {
                console.error('Sync request failed:', error);
                btn.classList.remove('spinning');
                status.textContent = 'Sync failed';
                status.className = 'sync-status waiting';
            }
        }
        
        // Auto-refresh every 30 seconds
        setInterval(() => {
            if (typeof healthDashboard !== 'undefined' && healthDashboard) {
                healthDashboard.fetchWeeklyData();
            }
        }, 30000);
        
        // ==========================================
        // CALORIE TRACKER FUNCTIONALITY
        // ==========================================
        
        let calorieGoal = 2000;
        let foodEntries = [];
        let foodEntriesUnsubscribe = null;
        
        // Get today's date string for document ID
        function getTodayString() {
            const today = new Date();
            return `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
        }
        
        // Load calorie goal from Firebase
        async function loadCalorieGoal(userId) {
            try {
                const doc = await db.collection('users').doc(userId).get();
                if (doc.exists && doc.data().calorieGoal) {
                    calorieGoal = doc.data().calorieGoal;
                }
                updateCalorieDisplay();
            } catch (error) {
                console.error('Failed to load calorie goal:', error);
            }
        }
        
        // Save calorie goal to Firebase
        async function saveCalorieGoalToFirebase(goal) {
            const user = firebase.auth().currentUser;
            if (!user) return;
            try {
                await db.collection('users').doc(user.uid).set({
                    calorieGoal: goal
                }, { merge: true });
                console.log('‚úÖ Calorie goal saved:', goal);
            } catch (error) {
                console.error('Failed to save calorie goal:', error);
            }
        }
        
        // Start listening to food entries
        function startFoodEntriesListener(userId) {
            if (foodEntriesUnsubscribe) foodEntriesUnsubscribe();
            
            foodEntriesUnsubscribe = db.collection('users').doc(userId)
                .collection('calorieEntries')
                .where('date', '==', getTodayString())
                .orderBy('timestamp', 'desc')
                .onSnapshot(snapshot => {
                    foodEntries = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    renderFoodLog();
                    updateCalorieDisplay();
                }, error => {
                    console.error('Food entries listener error:', error);
                });
        }
        
        // Render food log
        function renderFoodLog() {
            const container = document.getElementById('foodLog');
            
            if (foodEntries.length === 0) {
                container.innerHTML = `<div class="food-log-empty">ü•ó No food logged today</div>`;
                return;
            }
            
            container.innerHTML = foodEntries.map(entry => {
                const time = entry.timestamp?.toDate ? entry.timestamp.toDate() : new Date(entry.timestamp);
                const timeStr = time.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true });
                const emoji = getFoodEmoji(entry.name);
                
                return `
                    <div class="food-log-item" data-id="${entry.id}">
                        <div class="food-log-icon">${emoji}</div>
                        <div class="food-log-info">
                            <div class="food-log-name">${entry.name}</div>
                            <div class="food-log-time">${timeStr}</div>
                        </div>
                        <div class="food-log-calories">${entry.calories} cal</div>
                        <button class="food-log-delete" onclick="deleteFoodEntry('${entry.id}')" title="Delete">‚úï</button>
                    </div>
                `;
            }).join('');
        }
        
        // Get food emoji based on name
        function getFoodEmoji(name) {
            const lower = name.toLowerCase();
            if (lower.includes('breakfast') || lower.includes('egg') || lower.includes('cereal') || lower.includes('toast')) return 'üç≥';
            if (lower.includes('lunch')) return 'ü•™';
            if (lower.includes('dinner') || lower.includes('supper')) return 'üçΩÔ∏è';
            if (lower.includes('coffee') || lower.includes('latte')) return '‚òï';
            if (lower.includes('tea')) return 'üçµ';
            if (lower.includes('salad') || lower.includes('vegetable')) return 'ü•ó';
            if (lower.includes('fruit') || lower.includes('apple') || lower.includes('banana')) return 'üçé';
            if (lower.includes('chicken') || lower.includes('meat') || lower.includes('beef') || lower.includes('steak')) return 'üçó';
            if (lower.includes('fish') || lower.includes('salmon') || lower.includes('tuna')) return 'üêü';
            if (lower.includes('pizza')) return 'üçï';
            if (lower.includes('burger') || lower.includes('hamburger')) return 'üçî';
            if (lower.includes('sandwich') || lower.includes('sub')) return 'ü•™';
            if (lower.includes('pasta') || lower.includes('spaghetti') || lower.includes('noodle')) return 'üçù';
            if (lower.includes('rice') || lower.includes('sushi')) return 'üçö';
            if (lower.includes('soup')) return 'üç≤';
            if (lower.includes('bread') || lower.includes('bagel')) return 'üçû';
            if (lower.includes('cake') || lower.includes('dessert') || lower.includes('ice cream') || lower.includes('cookie')) return 'üç∞';
            if (lower.includes('chocolate') || lower.includes('candy')) return 'üç´';
            if (lower.includes('snack') || lower.includes('chips') || lower.includes('crackers')) return 'üçø';
            if (lower.includes('smoothie') || lower.includes('shake') || lower.includes('juice')) return 'ü•§';
            if (lower.includes('water')) return 'üíß';
            if (lower.includes('soda') || lower.includes('coke') || lower.includes('cola')) return 'ü•§';
            if (lower.includes('beer') || lower.includes('wine') || lower.includes('alcohol')) return 'üç∫';
            return 'üç¥';
        }
        
        // Update calorie display
        function updateCalorieDisplay() {
            const totalEaten = foodEntries.reduce((sum, entry) => sum + (entry.calories || 0), 0);
            const remaining = calorieGoal - totalEaten;
            const percentage = Math.min((totalEaten / calorieGoal) * 100, 100);
            const isOverBudget = remaining < 0;
            
            // Update eaten value
            document.getElementById('caloriesEatenDisplay').textContent = totalEaten;
            
            // Update goal display
            document.getElementById('calorieGoalDisplay').textContent = calorieGoal;
            
            // Update remaining value
            const remainingEl = document.getElementById('caloriesRemainingDisplay');
            if (isOverBudget) {
                remainingEl.textContent = '+' + Math.abs(remaining);
                remainingEl.classList.add('over-budget');
                remainingEl.classList.remove('remaining');
            } else {
                remainingEl.textContent = remaining;
                remainingEl.classList.remove('over-budget');
                remainingEl.classList.add('remaining');
            }
            
            // Update ring progress (circumference = 2 * PI * 65 = 408.4)
            const circumference = 2 * Math.PI * 65;
            const offset = circumference * (1 - (percentage / 100));
            const ring = document.getElementById('calorieRingProgress');
            ring.style.strokeDasharray = circumference;
            ring.style.strokeDashoffset = offset;
            
            if (isOverBudget) {
                ring.classList.add('over-budget');
            } else {
                ring.classList.remove('over-budget');
            }
        }
        
        // Add food entry
        async function addFoodEntry() {
            const nameInput = document.getElementById('foodNameInput');
            const caloriesInput = document.getElementById('foodCaloriesInput');
            
            const name = nameInput.value.trim();
            const calories = parseInt(caloriesInput.value);
            
            if (!name) {
                nameInput.focus();
                nameInput.style.borderColor = 'var(--accent-tertiary)';
                setTimeout(() => nameInput.style.borderColor = '', 1000);
                return;
            }
            
            if (!calories || calories <= 0) {
                caloriesInput.focus();
                caloriesInput.style.borderColor = 'var(--accent-tertiary)';
                setTimeout(() => caloriesInput.style.borderColor = '', 1000);
                return;
            }
            
            const user = firebase.auth().currentUser;
            if (!user) {
                alert('Please log in to track calories');
                return;
            }
            
            const btn = document.getElementById('addFoodBtn');
            btn.disabled = true;
            
            try {
                const entry = {
                    name: name,
                    calories: calories,
                    date: getTodayString(),
                    timestamp: firebase.firestore.Timestamp.now()
                };
                
                await db.collection('users').doc(user.uid)
                    .collection('calorieEntries')
                    .add(entry);
                
                // Clear inputs
                nameInput.value = '';
                caloriesInput.value = '';
                nameInput.focus();
                
                console.log('‚úÖ Food entry added:', name, calories);
            } catch (error) {
                console.error('Failed to add food entry:', error);
                alert('Failed to add food. Please try again.');
            } finally {
                btn.disabled = false;
            }
        }
        
        // Delete food entry
        async function deleteFoodEntry(entryId) {
            const user = firebase.auth().currentUser;
            if (!user) return;
            
            try {
                await db.collection('users').doc(user.uid)
                    .collection('calorieEntries')
                    .doc(entryId)
                    .delete();
                console.log('‚úÖ Food entry deleted');
            } catch (error) {
                console.error('Failed to delete food entry:', error);
            }
        }
        
        // Goal Modal Functions
        function openGoalModal() {
            document.getElementById('goalInput').value = calorieGoal;
            document.getElementById('goalModal').classList.add('active');
        }
        
        function closeGoalModal() {
            document.getElementById('goalModal').classList.remove('active');
        }
        
        function setQuickGoal(goal) {
            document.getElementById('goalInput').value = goal;
        }
        
        function saveCalorieGoal() {
            const input = document.getElementById('goalInput');
            const newGoal = parseInt(input.value);
            
            if (!newGoal || newGoal < 500 || newGoal > 10000) {
                input.style.borderColor = 'var(--accent-tertiary)';
                setTimeout(() => input.style.borderColor = '', 1000);
                return;
            }
            
            calorieGoal = newGoal;
            saveCalorieGoalToFirebase(newGoal);
            updateCalorieDisplay();
            closeGoalModal();
        }
        
        // Handle Enter key for food input
        document.getElementById('foodNameInput')?.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                document.getElementById('foodCaloriesInput').focus();
            }
        });
        
        document.getElementById('foodCaloriesInput')?.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                addFoodEntry();
            }
        });
        
        // Close modal on overlay click
        document.getElementById('goalModal')?.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal-overlay')) {
                closeGoalModal();
            }
        });
        
        // Initialize calorie tracker when auth state changes
        window.addEventListener('authStateChanged', (e) => {
            const user = e.detail;
            if (user) {
                loadCalorieGoal(user.uid);
                startFoodEntriesListener(user.uid);
            }
        });
        
        // Fallback initialization
        setTimeout(() => {
            const user = firebase.auth().currentUser;
            if (user) {
                loadCalorieGoal(user.uid);
                startFoodEntriesListener(user.uid);
            }
        }, 2500);
        
        // Cleanup on page leave
        window.addEventListener('beforeunload', () => {
            if (foodEntriesUnsubscribe) foodEntriesUnsubscribe();
        });
        
        // ==========================================
        // FOOD SEARCH FUNCTIONALITY
        // ==========================================
        
        let searchTimeout = null;
        
        // Initialize search input listeners
        document.getElementById('foodSearchInput')?.addEventListener('input', (e) => {
            const query = e.target.value.trim();
            const container = document.getElementById('foodSearchContainer');
            
            // Toggle has-value class for clear button
            if (query.length > 0) {
                container.classList.add('has-value');
            } else {
                container.classList.remove('has-value');
            }
            
            // Debounce search
            clearTimeout(searchTimeout);
            
            if (query.length < 2) {
                hideSearchResults();
                return;
            }
            
            showSearchLoading();
            
            searchTimeout = setTimeout(() => {
                searchFoodsAPI(query);
            }, 400);
        });
        
        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            const container = document.getElementById('foodSearchContainer');
            if (container && !container.contains(e.target)) {
                hideSearchResults();
            }
        });
        
        // Search OpenFoodFacts API
        async function searchFoodsAPI(query) {
            try {
                const response = await fetch(
                    `https://world.openfoodfacts.org/cgi/search.pl?search_terms=${encodeURIComponent(query)}&search_simple=1&action=process&json=1&page_size=12&fields=code,product_name,product_name_en,brands,image_front_small_url,nutriments`
                );
                const data = await response.json();
                
                if (data.products && data.products.length > 0) {
                    renderSearchResults(data.products);
                } else {
                    showSearchEmpty();
                }
            } catch (error) {
                console.error('Food search failed:', error);
                showSearchEmpty('Search failed. Try again.');
            }
        }
        
        // Render search results
        function renderSearchResults(products) {
            const dropdown = document.getElementById('searchResults');
            
            dropdown.innerHTML = products.map(product => {
                const name = product.product_name || product.product_name_en || 'Unknown';
                const brand = product.brands || '';
                const calories = Math.round(product.nutriments?.['energy-kcal_100g'] || 0);
                const image = product.image_front_small_url || '';
                const emoji = getFoodEmoji(name);
                
                // Create safe JSON for onclick
                const productData = encodeURIComponent(JSON.stringify({
                    name: name.substring(0, 50),
                    brand: brand.substring(0, 30),
                    calories: calories,
                    protein: Math.round(product.nutriments?.['proteins_100g'] || 0),
                    carbs: Math.round(product.nutriments?.['carbohydrates_100g'] || 0),
                    fat: Math.round(product.nutriments?.['fat_100g'] || 0)
                }));
                
                return `
                    <div class="search-result-item" onclick="addFromSearch('${productData}')">
                        <div class="search-result-icon">
                            ${image ? `<img src="${image}" alt="" onerror="this.parentElement.innerHTML='${emoji}'">` : emoji}
                        </div>
                        <div class="search-result-info">
                            <div class="search-result-name">${escapeHtml(name)}</div>
                            ${brand ? `<div class="search-result-brand">${escapeHtml(brand)}</div>` : ''}
                        </div>
                        <div class="search-result-cals">${calories} cal</div>
                        <button class="search-result-add" title="Add to log">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                <path d="M12 5v14M5 12h14"/>
                            </svg>
                        </button>
                    </div>
                `;
            }).join('');
            
            dropdown.classList.add('active');
        }
        
        // Add food from search result
        async function addFromSearch(encodedProduct) {
            const product = JSON.parse(decodeURIComponent(encodedProduct));
            
            const user = firebase.auth().currentUser;
            if (!user) {
                alert('Please log in to track calories');
                return;
            }
            
            try {
                const entry = {
                    name: product.name + (product.brand ? ` (${product.brand})` : ''),
                    calories: product.calories,
                    protein: product.protein || 0,
                    carbs: product.carbs || 0,
                    fat: product.fat || 0,
                    date: getTodayString(),
                    timestamp: firebase.firestore.Timestamp.now(),
                    source: 'openfoodfacts'
                };
                
                await db.collection('users').doc(user.uid)
                    .collection('calorieEntries')
                    .add(entry);
                
                // Clear search and show success
                clearSearch();
                console.log('‚úÖ Added from search:', entry.name, entry.calories);
                
                // Brief visual feedback
                showSearchSuccess();
            } catch (error) {
                console.error('Failed to add food:', error);
                alert('Failed to add food. Please try again.');
            }
        }
        
        // Helper functions for search UI
        function showSearchLoading() {
            const dropdown = document.getElementById('searchResults');
            dropdown.innerHTML = '<div class="search-loading">Searching foods...</div>';
            dropdown.classList.add('active');
        }
        
        function showSearchEmpty(message = 'No foods found. Try a different search.') {
            const dropdown = document.getElementById('searchResults');
            dropdown.innerHTML = `<div class="search-empty">üîç ${message}</div>`;
            dropdown.classList.add('active');
        }
        
        function showSearchSuccess() {
            const input = document.getElementById('foodSearchInput');
            input.style.borderColor = 'var(--accent-secondary)';
            input.placeholder = '‚úì Added! Search for more...';
            setTimeout(() => {
                input.style.borderColor = '';
                input.placeholder = 'Search foods (e.g., banana, chicken breast...)';
            }, 1500);
        }
        
        function hideSearchResults() {
            const dropdown = document.getElementById('searchResults');
            if (dropdown) {
                dropdown.classList.remove('active');
            }
        }
        
        function clearSearch() {
            const input = document.getElementById('foodSearchInput');
            const container = document.getElementById('foodSearchContainer');
            if (input) {
                input.value = '';
                container.classList.remove('has-value');
            }
            hideSearchResults();
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Manual entry toggle
        function toggleManualEntry() {
            const row = document.getElementById('manualEntryRow');
            const text = document.getElementById('manualToggleText');
            
            if (row.classList.contains('active')) {
                row.classList.remove('active');
                text.textContent = 'Add manually';
            } else {
                row.classList.add('active');
                text.textContent = 'Hide manual entry';
                document.getElementById('foodNameInput').focus();
            }
        }
    </script>
</body>
</html>

